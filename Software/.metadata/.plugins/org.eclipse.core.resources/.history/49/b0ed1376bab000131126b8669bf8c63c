/*
 * bluetooth.c
 *
 *  Created on: Mar 18, 2014
 *      Author: Anthony
 */


#include "bluetooth.h"

typedef struct {
	UART_Handle handle;
	UART_Params params;
} blue_smirf_t;


blue_smirf_t bluesmirf;

// Controls TI-RTOS Clock start via a handle.
extern const Clock_Handle blueSmirf_Update;

void initBlueSmirf() {

	SysCtlPeripheralEnable(SYSCTL_PERIPH_UART3);
	GPIOPinConfigure(GPIO_PC6_U3RX);
	GPIOPinConfigure(GPIO_PC7_U3TX);
	GPIOPinTypeUART(GPIO_PORTC_BASE, GPIO_PIN_6 | GPIO_PIN_7);
}

void bluetooth_open(){
	UART_Params_init(&(bluesmirf.params));
	bluesmirf.params.baudRate  = 115200;
	bluesmirf.params.writeDataMode = UART_DATA_BINARY;
	bluesmirf.params.readDataMode = UART_DATA_BINARY;
	bluesmirf.params.readReturnMode = UART_RETURN_FULL;
	bluesmirf.params.readEcho = UART_ECHO_OFF;
	bluesmirf.handle = UART_open(EK_TM4C123GXL_UART3, &(bluesmirf.params));
	if (!bluesmirf.handle) {
		System_printf("UART did not open");
	}
}

void sendSmirfPacket(char *data, int len) {
	int ret = UART_write(bluesmirf.handle, data, len);
	//System_printf("The UART wrote %d bytes\n", ret);
}

void getPacketFromSmirf(char *data, int len) {
	int ret = UART_read(bluesmirf.handle, data, len);
	//System_printf("The UART read %d bytes\n", ret);
}
